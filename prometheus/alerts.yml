groups:
  - name: ledger_alerts
    rules:
      - alert: ApiDown
        expr: up{job="luisbank_api"} == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "API down"
      - alert: DatabaseDown
        expr: up{job="postgres_exporter"} == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Database down"
      - alert: RedisDown
        expr: redis_up == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Redis down"
      - alert: HighErrorRate
        expr: sum(rate(app_errors_total[1m])) > 2
        for: 1m
        labels:
          severity: high
        annotations:
          summary: "High error rate"
      - alert: HighLatency
        expr: histogram_quantile(0.95, sum(rate(app_request_latency_seconds_bucket[5m])) by (le)) > 1
        for: 2m
        labels:
          severity: high
        annotations:
          summary: "High latency p95"
      - alert: HighLatencyP50
        expr: histogram_quantile(0.50, sum(rate(app_request_latency_seconds_bucket[5m])) by (le)) > 0.3
        for: 2m
        labels:
          severity: medium
        annotations:
          summary: "High latency p50"
      - alert: HighLatencyP99
        expr: histogram_quantile(0.99, sum(rate(app_request_latency_seconds_bucket[5m])) by (le)) > 2
        for: 2m
        labels:
          severity: high
        annotations:
          summary: "High latency p99"
      - alert: FraudSpike
        expr: sum(rate(fraud_detected_total[5m])) > 1
        for: 2m
        labels:
          severity: high
        annotations:
          summary: "Fraud spike detected"
      - alert: LedgerIntegrityFailed
        expr: ledger_integrity_ok == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Ledger integrity check failed"
      - alert: LedgerIntegrityStale
        expr: (time() - ledger_integrity_last_run_timestamp) > 600
        for: 2m
        labels:
          severity: high
        annotations:
          summary: "Ledger integrity check is stale"
